This README for the giab-utils/handy_scripts/aspera_scripts directory was
generated by Sierra D. Miller on 2021-11-30

# ftp_sra_transfer.sh
## PURPOSE

This script, executable from bash command line, allows the user to download
and upload files to and from:

1. The GIAB ftp site <ftp-trace.ncbi.nlm.nih.gov> 
2. NCBI SRA <https://www.ncbi.nlm.nih.gov/sra>

## DEPENDENCIES
### GLOBAL VARIABLES

User must have the following global environments defined in their bash 
profile (MacOS: .bash_profile)
    - ```ASPERA_OPENKEY```= path to aspera openssh or pUTTY file. 
    - ```GIAB_FTPKEY```= path to validated ftp rsa key file. 


*The **ASPERA_OPENKEY** will be the openssh file within your aspera dir.*
*For example mine is located:*
```mambaforge/pkgs/aspera-cli-3.9.1-0/etc/asperaweb_id_dsa.openssh```  
*From what Iâ€™ve read, Mac users use openssh and Windows use pUTTY.*

*The **GIAB_FTPKEY** is a key generated on the user-end and validated by*
*Chunlin. However, there is an issue generating these keys via Mac*
*so we have been instructed to a shared key that Nate Olson has*
*posession of. Please contact him to use this key if you do not*
*currently have one.*

__NOTE__ For the **GIAB_FTPKEY** use the 'sra-rsakey' not 'sra-rsakey.pub'.

### ASPERA CONDA ENV

User must have aspera installed and the ascp command available at the 
command line. Please see the associated config file to set up appropriate 
conda install. Please use associated file for conda setup: ```environment_aspera.yml```

Install as such: 

```conda env create -f environment_aspera.yml```

Prior to running the script, activate conda environment as such: 

```conda activate aspera```

## USAGE

This script has two modes: **upload** and **download** 
from two sources: **GIAB FTP site** and **NCBI SRA**

__NOTE__ that entire directoires can be up/downloaded with this script.

### FLAGS

REQUIRED: 

- **m**: The **mode** - either *upload* or *download*. __NOTE__
that capitlization matters. 
- **r**: The chosen *remote* database. Either *ftp* or *sra* __NOTE__
that capitlization matters. 

ADDITIONAL FLAGS:

- **d**: The remote **directory** or specific file path for the desired download or
the upload destination. 

__NOTE__ This flag is optional when the chosen mode is *upload*. 

__NOTE__ The default upload destination for the ftp site is 
```asp-sra@upload.ncbi.nlm.nih.gov:GIAB-incoming/NIST/```.
This default destination is typically desired. Once uploads have been successful, email
[Chunlin](xiao2@ncbi.nlm.nih.gov) with information on what file(s) were transferred, where 
they go, and associated md5s. Any path beyond this can be appended and would be passed
with this flag.

__NOTE__ The default upload destination for sra is 
```subasp@upload.ncbi.nlm.nih.gov:uploads/```. This is not desired and you should 
instead use the provided path from sra during the web portal submission process. 
That address will be appended to this one for upload.


- **l**: The **local** destination path to where the file(s) are *downloaded* to
or the file/directory that is being *uploaded*. 

__NOTE__ This flag is optional when the chosen mode is *download*. In such a case, 
the file(s) will download to the current working directory. 


### EXECUTION

**Example FTP download command:** 

```bash ftp_sra_transfer.sh -m download -r ftp -d /ReferenceSamples/giab/data/AshkenazimTrio/HG002_NA24385_son/PacBio_CCS_10kb/alignment/README.txt -l ~/Desktop```

__NOTE__ The -l flag is provided as a destination path but is not needed. The default
download location is the current working directory.

**Example FTP upload command:** 

*No specified subdirectory*

```bash ftp_sra_transfer.sh -m upload -r ftp -l /Users/sdm8/Desktop/test.ignore2.txt```

__NOTE__ With no specified -d flag, it will default to ```asp-sra@upload.ncbi.nlm.nih.gov:GIAB-incoming/NIST/```

*With specified subdirectory*test

```bash ftp_sra_transfer.sh -m upload -r ftp -d /ReferenceSamples/giab/data/AshkenazimTrio/HG002_NA24385_son/ -l /Users/sdm8/Desktop/test.ignore2.txt```


Following upload, email Chunlin stating where files are, where they go, and provide md5s. 

**Example SRA download command:** 

```bash ftp_sra_transfer.sh -m download -r sra -d /SampleData/Genomes/BioSample/Sample_BioSample.xml -l ~/Desktop```

**Example SRA download command:** 

__NOTE__ UNTESTED! Need an actual upload dir to test.

```bash ftp_sra_transfer.sh -m upload -r sra -l  ~/Desktop/test.ignore2.txt```

## ASSOCIATED DOCUMENTS/RESOURCES

